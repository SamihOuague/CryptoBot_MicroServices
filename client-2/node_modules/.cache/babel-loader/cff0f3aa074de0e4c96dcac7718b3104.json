{"ast":null,"code":"import _regeneratorRuntime from\"/home/souaguen/workdir/CryptoBot_MicroServices/client-2/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"/home/souaguen/workdir/CryptoBot_MicroServices/client-2/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import{createSlice,createAsyncThunk}from\"@reduxjs/toolkit\";export var loginAsyncThunk=createAsyncThunk(\"auth/login\",/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(data){var response;return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return fetch(\"\".concat(process.env.REACT_APP_API_URL,\"/login\"),{method:\"POST\",headers:{\"Content-Type\":\"application/json\",\"Accept\":\"application/json\"},body:JSON.stringify(data)});case 3:_context.next=5;return _context.sent.json();case 5:response=_context.sent;return _context.abrupt(\"return\",response);case 9:_context.prev=9;_context.t0=_context[\"catch\"](0);return _context.abrupt(\"return\",_context.t0);case 12:case\"end\":return _context.stop();}}},_callee,null,[[0,9]]);}));return function(_x){return _ref.apply(this,arguments);};}());export var pingAsyncThunk=createAsyncThunk(\"auth/ping\",/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(){var response;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.prev=0;_context2.next=3;return fetch(\"\".concat(process.env.REACT_APP_API_URL,\"/ping\"),{method:\"POST\",headers:{\"Content-Type\":\"application/json\",\"Accept\":\"application/json\",\"Authorization\":\"Barear \".concat(localStorage.getItem(\"token\"))}});case 3:_context2.next=5;return _context2.sent.json();case 5:response=_context2.sent;return _context2.abrupt(\"return\",response);case 9:_context2.prev=9;_context2.t0=_context2[\"catch\"](0);return _context2.abrupt(\"return\",_context2.t0);case 12:case\"end\":return _context2.stop();}}},_callee2,null,[[0,9]]);})));export var updateLogAsyncThunk=createAsyncThunk(\"auth/updateLog\",/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee3(data){var response;return _regeneratorRuntime().wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.prev=0;_context3.next=3;return fetch(\"\".concat(process.env.REACT_APP_API_URL,\"/update-user\"),{method:\"POST\",headers:{\"Content-Type\":\"application/json\",\"Accept\":\"application/json\",\"Authorization\":\"Barear \".concat(localStorage.getItem(\"token\"))},body:JSON.stringify(data)});case 3:_context3.next=5;return _context3.sent.json();case 5:response=_context3.sent;return _context3.abrupt(\"return\",response);case 9:_context3.prev=9;_context3.t0=_context3[\"catch\"](0);return _context3.abrupt(\"return\",_context3.t0);case 12:case\"end\":return _context3.stop();}}},_callee3,null,[[0,9]]);}));return function(_x2){return _ref3.apply(this,arguments);};}());var initialState={token:localStorage.getItem(\"token\"),pending:false,apiKey:false,connected:false};export var authSlice=createSlice({name:\"auth\",initialState:initialState,reducers:{logOut:function logOut(state){state.token=null;localStorage.removeItem(\"token\");}},extraReducers:function extraReducers(builder){builder.addCase(loginAsyncThunk.fulfilled,function(state,action){if(action.payload.token){state.token=action.payload.token;state.apiKey=action.payload.apiKey;localStorage.setItem(\"token\",action.payload.token);}state.pending=false;}).addCase(loginAsyncThunk.pending,function(state){state.token=null;state.pending=true;}).addCase(loginAsyncThunk.rejected,function(state){state.token=null;state.pending=false;});builder.addCase(pingAsyncThunk.fulfilled,function(state,action){if(!action.payload.connected){state.token=null;state.pending=false;localStorage.removeItem(\"token\");}else{state.apiKey=action.payload.apiKey;state.connected=true;}}).addCase(pingAsyncThunk.pending,function(state){state.pending=true;}).addCase(pingAsyncThunk.rejected,function(state){state.token=null;state.pending=false;state.connected=false;localStorage.removeItem(\"token\");});builder.addCase(updateLogAsyncThunk.fulfilled,function(state){state.pending=false;}).addCase(updateLogAsyncThunk.pending,function(state){state.pending=true;}).addCase(updateLogAsyncThunk.rejected,function(state){state.pending=false;});}});var logOut=authSlice.actions.logOut;export{logOut};export default authSlice.reducer;","map":{"version":3,"names":["createSlice","createAsyncThunk","loginAsyncThunk","data","fetch","process","env","REACT_APP_API_URL","method","headers","body","JSON","stringify","json","response","pingAsyncThunk","localStorage","getItem","updateLogAsyncThunk","initialState","token","pending","apiKey","connected","authSlice","name","reducers","logOut","state","removeItem","extraReducers","builder","addCase","fulfilled","action","payload","setItem","rejected","actions","reducer"],"sources":["/home/souaguen/workdir/CryptoBot_MicroServices/client-2/src/app/features/auth/authSlice.js"],"sourcesContent":["import { createSlice, createAsyncThunk } from \"@reduxjs/toolkit\";\n\nexport const loginAsyncThunk = createAsyncThunk(\"auth/login\", async (data) => {\n    try {\n        const response = await (await fetch(`${process.env.REACT_APP_API_URL}/login`, {\n            method: \"POST\",\n            headers: {\n                \"Content-Type\": \"application/json\",\n                \"Accept\": \"application/json\",\n            },\n            body: JSON.stringify(data),\n        })).json();\n        return response;\n    } catch(err) {\n        return err;\n    }\n});\n\nexport const pingAsyncThunk = createAsyncThunk(\"auth/ping\", async () => {\n    try {\n        const response = await (await fetch(`${process.env.REACT_APP_API_URL}/ping`, {\n            method: \"POST\",\n            headers: {\n                \"Content-Type\": \"application/json\",\n                \"Accept\": \"application/json\",\n                \"Authorization\": `Barear ${localStorage.getItem(\"token\")}`,\n            }\n        })).json();\n        return response;\n    } catch(err) {\n        return err;\n    }\n});\n\nexport const updateLogAsyncThunk = createAsyncThunk(\"auth/updateLog\", async (data) => {\n    try {\n        const response = await (await fetch(`${process.env.REACT_APP_API_URL}/update-user`, {\n            method: \"POST\",\n            headers: {\n                \"Content-Type\": \"application/json\",\n                \"Accept\": \"application/json\",\n                \"Authorization\": `Barear ${localStorage.getItem(\"token\")}`,\n            },\n            body: JSON.stringify(data),\n        })).json();\n        return response;\n    } catch(err) {\n        return err;\n    }\n});\n\n\nconst initialState = {\n    token: localStorage.getItem(\"token\"),\n    pending: false,\n    apiKey: false,\n    connected: false\n};\n\nexport const authSlice = createSlice({\n    name: \"auth\",\n    initialState,\n    reducers: {\n        logOut: (state) => {\n            state.token = null;\n            localStorage.removeItem(\"token\");\n        }\n    },\n    extraReducers: (builder) => {\n        builder.addCase(loginAsyncThunk.fulfilled, (state, action) => {\n            if (action.payload.token) {\n                state.token = action.payload.token;\n                state.apiKey = action.payload.apiKey;\n                localStorage.setItem(\"token\", action.payload.token);\n            }\n            state.pending = false;\n        }).addCase(loginAsyncThunk.pending, (state) => {\n            state.token = null;\n            state.pending = true;\n        }).addCase(loginAsyncThunk.rejected, (state) => {\n            state.token = null;\n            state.pending = false;\n        });\n\n        builder.addCase(pingAsyncThunk.fulfilled, (state, action) => {\n            if (!action.payload.connected) {\n                state.token = null;\n                state.pending = false;\n                localStorage.removeItem(\"token\");\n            } else {\n                state.apiKey = action.payload.apiKey;\n                state.connected = true;\n            }\n        }).addCase(pingAsyncThunk.pending, (state) => {\n            state.pending = true;\n        }).addCase(pingAsyncThunk.rejected, (state) => {\n            state.token = null;\n            state.pending = false;\n            state.connected = false;\n            localStorage.removeItem(\"token\");\n        });\n\n        builder.addCase(updateLogAsyncThunk.fulfilled, (state) => {\n            state.pending = false;\n        }).addCase(updateLogAsyncThunk.pending, (state) => {\n            state.pending = true;\n        }).addCase(updateLogAsyncThunk.rejected, (state) => {\n            state.pending = false;\n        });\n    }\n});\n\nexport const { logOut } = authSlice.actions;\n\nexport default authSlice.reducer;"],"mappings":"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"},"metadata":{},"sourceType":"module"}